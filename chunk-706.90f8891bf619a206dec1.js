"use strict";(self.webpackChunkhopital_availabilty_frontend=self.webpackChunkhopital_availabilty_frontend||[]).push([[706],{87739:function(e,t,r){var n=r(64836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(64938)),a=r(85893),o=(0,i.default)((0,a.jsx)("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"}),"Https");t.default=o},75503:function(e,t,r){var n=r(64836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(64938)),a=r(85893),o=(0,i.default)((0,a.jsx)("path",{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"}),"KeyboardArrowDown");t.default=o},28504:function(e,t,r){var n=r(64836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(64687)),a=n(r(17156)),o=n(r(56690)),s=n(r(89728)),c=n(r(38416)),u=r(46277),d=r(23624),l=r(77372),f=function(){function e(t,r,n,i,a,s){var l=this;(0,o.default)(this,e),(0,c.default)(this,"mediaStream",new MediaStream),(0,c.default)(this,"media",new h),(0,c.default)(this,"connected",!1),(0,c.default)(this,"makingOffer",!1),(0,c.default)(this,"polite",!1),this.localVideo=n,this.remoteVideo=i,this.remoteAudio=a,this.notifyUser=s;var f={token:t,to:r},p=new WebSocket(u.WEBSOCKET_URL+(0,d.getAuth)()),v=new Promise((function(e){return p.onopen=function(){p.send(JSON.stringify({type:u.TYPE_REGISTER,metadata:f})),e()}}));p.onmessage=function(e){var t=e.data;console.log(JSON.parse(t),"recieved"),l.onMessage(JSON.parse(t))},this.send=function(e,t){return v.then((function(){p.send(JSON.stringify({type:e,data:t,metadata:f})),console.log({type:e,data:t,metadata:f},"sent")}))},this.peer=new RTCPeerConnection({iceServers:u.DEFAULT_ICE_SERVERS}),this.peerReady=new Promise((function(e){return l.peer.onnegotiationneeded=e})),this.peer.onicecandidate=function(e){var t=e.candidate;return t&&l.send(u.TYPE_ICECANDIDATE,t)},this.peer.ontrack=function(e){var t=e.streams;console.log("got stream",t[0]),t[0]&&(l.remoteAudio.srcObject=new MediaStream([t[0].getAudioTracks()[0]]),l.remoteVideo.srcObject=new MediaStream([t[0].getVideoTracks()[0]]))},this.media.on("newStream",(function(e){return l.handleTrackFromMedia(e)})),this.setUpMedia(),p.onclose=this.tearDown=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.log(t[0]),l.media.end(),p.close(),l.peer.close()},this.peer.addEventListener("connectionstatechange",(function(e){console.log(l.peer.connectionState),"connected"===l.peer.connectionState?(l.connected=!0,console.log("yaay connected")):l.connected=!1}))}var t,r,n,l,f;return(0,s.default)(e,[{key:"makeCall",value:(f=(0,a.default)(i.default.mark((function e(){var t=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.peer.addEventListener("negotiationneeded",(function(){return t.createOffer()})),this.createOffer(),this.polite=!0;case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"createOffer",value:(l=(0,a.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.makingOffer=!0,e.next=4,this.peer.createOffer();case 4:if(t=e.sent,"stable"==this.peer.signalingState){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.peer.setLocalDescription(t);case 9:this.send(u.TYPE_DESCRIPTION,this.peer.localDescription),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),console.log("ONN ".concat(e.t0));case 15:return e.prev=15,this.makingOffer=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[0,12,15,18]])}))),function(){return l.apply(this,arguments)})},{key:"handleDescription",value:(n=(0,a.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=20;break}if(r="offer"==t.type&&(this.makingOffer||"stable"!=this.peer.signalingState),this.polite||!r){e.next=5;break}return e.abrupt("return");case 5:if(!r){e.next=10;break}return e.next=8,Promise.all([this.peer.setLocalDescription({type:"rollback"}),this.peer.setRemoteDescription(t)]);case 8:e.next=12;break;case 10:return e.next=12,this.peer.setRemoteDescription(t);case 12:if("offer"!=t.type){e.next=20;break}return e.t0=this.peer,e.next=16,this.peer.createAnswer();case 16:return e.t1=e.sent,e.next=19,e.t0.setLocalDescription.call(e.t0,e.t1);case 19:this.send(u.TYPE_DESCRIPTION,this.peer.localDescription);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setUpMedia",value:(r=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.media.setMediaStream("video");case 2:return e.next=4,this.media.setMediaStream("audio");case 4:this.handleTrackFromMedia("video"),this.handleTrackFromMedia("audio");case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleTrackFromMedia",value:function(e){"video"===e&&this.media.videoTrack&&(this.videoRTCRtpSender=this.addTrack(this.media.videoTrack),this.localVideo.srcObject=new MediaStream([this.media.videoTrack])),"audio"===e&&this.media.audioTrack&&(this.audioRTCRtpSender=this.addTrack(this.media.audioTrack))}},{key:"addTrack",value:function(e){return console.log(this.mediaStream,e),console.log(this.peer.connectionState),this.peer.addTrack(e,this.mediaStream)}},{key:"removeStream",value:function(e){"video"===e&&this.videoRTCRtpSender?this.peer.removeTrack(this.videoRTCRtpSender):"audio"===e&&this.audioRTCRtpSender&&this.peer.removeTrack(this.audioRTCRtpSender)}},{key:"onMessage",value:(t=(0,a.default)(i.default.mark((function e(t){var r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.type,n=t.data,t.error,console.log(r),e.t0=r,e.next=e.t0===u.TYPE_ICECANDIDATE?5:e.t0===u.TYPE_CALL_REJECT||e.t0===u.TYPE_DESCRIPTION?8:e.t0===u.TYPE_CALL_END?10:13;break;case 5:return e.next=7,this.peer.addIceCandidate(n);case 7:return e.abrupt("break",14);case 8:return this.handleDescription(n),e.abrupt("break",14);case 10:return this.tearDown(),this.notifyUser(n).then(),e.abrupt("break",14);case 13:console.warn("Unknown message type",r);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.default=f;var h=function(){function e(){(0,o.default)(this,e),(0,c.default)(this,"deniedSources",{}),(0,c.default)(this,"emitter",new l.Events),(0,c.default)(this,"devices",{})}var t,r,n,u;return(0,s.default)(e,[{key:"setMediaStream",value:(u=(0,a.default)(i.default.mark((function e(t){var r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("video"!==t){e.next=8;break}return e.next=3,this.getTrack("video",this.devices.video);case 3:return this.videoTrack=e.sent,this.videoTrack&&(this.videoTrack.addEventListener("ended",(function(){delete r.videoTrack,r.emitter.emit("videoToggle",!1),r.emitter.emit("streamEnd","video")})),this.emitter.emit("videoToggle",!0)),e.abrupt("return",this.videoTrack);case 8:if("audio"!==t){e.next=14;break}return e.next=11,this.getTrack("audio",this.devices.audio);case 11:return this.audioTrack=e.sent,this.audioTrack&&(this.audioTrack.addEventListener("ended",(function(){delete r.videoTrack,r.emitter.emit("audioToggle",!1),r.emitter.emit("streamEnd","audio")})),this.emitter.emit("audioToggle",!0)),e.abrupt("return",this.audioTrack);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"on",value:function(e,t){return this.emitter.on(e,t)}},{key:"getTrack",value:(n=(0,a.default)(i.default.mark((function e(t,r){var n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia((0,c.default)({},t,!r||{deviceId:{exact:r}}));case 3:return n=e.sent,this.deniedSources[t]&&(this.deniedSources[t]=!1),e.abrupt("return",n.getTracks()[0]);case 8:if(e.prev=8,e.t0=e.catch(0),"NotAllowedError"!==e.t0.name&&"SecurityError"!=e.t0.name){e.next=15;break}this.deniedSources[t]=!0,this.emitter.emit("permissionDenied",t),e.next=16;break;case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"toggleCamera",value:(r=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.videoTrack){e.next=5;break}this.videoTrack.enabled=t,this.emitter.emit("videoToggle",t),e.next=10;break;case 5:return e.next=7,this.setMediaStream("video");case 7:if(!e.sent){e.next=10;break}this.emitter.emit("newStream","video"),this.emitter.emit("videoToggle",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"toggleMic",value:(t=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.audioTrack){e.next=5;break}this.audioTrack.enabled=t,this.emitter.emit("audioToggle",t),e.next=10;break;case 5:return e.next=7,this.setMediaStream("audio");case 7:if(!e.sent){e.next=10;break}this.emitter.emit("newStream","audio"),this.emitter.emit("audioToggle",!0);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"end",value:function(){var e,t;null===(e=this.videoTrack)||void 0===e||e.stop(),null===(t=this.audioTrack)||void 0===t||t.stop(),delete this.audioTrack,delete this.videoTrack}}]),e}()},46277:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WEBSOCKET_URL=t.TYPE_REGISTER=t.TYPE_OFFER=t.TYPE_ICECANDIDATE=t.TYPE_DESCRIPTION=t.TYPE_CALL_REJECT=t.TYPE_CALL_END=t.TYPE_ANSWER=t.DEFAULT_ICE_SERVERS=t.DEFAULT_CONSTRAINTS=void 0,t.DEFAULT_CONSTRAINTS={video:!0,audio:!0},t.DEFAULT_ICE_SERVERS=[{urls:"stun:stun.l.google.com:19302"}];var r="".concat(null==="https://api.dev.needmedi.com"?void 0:"https://api.dev.needmedi.com".replace("http","ws"),"/ws/chat/webrtc?token=");t.WEBSOCKET_URL=r,t.TYPE_OFFER="OFFER",t.TYPE_ANSWER="ANSWER",t.TYPE_ICECANDIDATE="ICE CANDIDATE",t.TYPE_CALL_REJECT="REJECT CALL",t.TYPE_REGISTER="REGISTER",t.TYPE_CALL_END="END CALL",t.TYPE_DESCRIPTION="DESCRIPTION"},77372:function(e,t,r){var n=r(64836);Object.defineProperty(t,"__esModule",{value:!0}),t.Events=void 0;var i=n(r(56690)),a=n(r(89728)),o=n(r(38416)),s=function(){function e(){(0,i.default)(this,e),(0,o.default)(this,"events",{})}return(0,a.default)(e,[{key:"emit",value:function(e){for(var t=this.events[e]||[],r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=t.length;a<o;a++)t[a].apply(t,n)}},{key:"on",value:function(e,t){var r,n=this;return(null===(r=this.events[e])||void 0===r?void 0:r.push(t))||(this.events[e]=[t]),function(){var r;n.events[e]=null===(r=n.events[e])||void 0===r?void 0:r.filter((function(e){return t!==e}))}}}]),e}();t.Events=s},76706:function(e,t,r){var n=r(64836);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(r(64687)),a=n(r(17156)),o=n(r(56690)),s=n(r(89728)),c=n(r(66115)),u=n(r(41588)),d=n(r(61655)),l=n(r(94993)),f=n(r(73808)),h=n(r(38416)),p=r(70917),v=r(14795),m=r(95110),k=n(r(55693)),T=n(r(75503)),E=n(r(87739)),y=r(23624),g=r(5977),b=(n(r(25727)),r(73727)),S=n(r(28504)),x=n(r(67294)),w=r(7758),C=r(12447),R=r(85893);function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,h.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}(0,v.styled)(k.default)((function(e){return{backgroundColor:"light"===e.theme.palette.mode?"#083CBE":m.grey[800]}}));var P=(0,C.withStyles)((function(e){return{root:{color:"white"}}}))(w.Button),D=function(e){(0,d.default)(m,e);var t,r,n,v=(r=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=(0,f.default)(r);if(n){var i=(0,f.default)(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return(0,l.default)(this,e)});function m(e){var t,r,n,s;(0,o.default)(this,m),s=v.call(this,e),(0,h.default)((0,c.default)(s),"localVideo",x.default.createRef()),(0,h.default)((0,c.default)(s),"remoteVideo",x.default.createRef()),(0,h.default)((0,c.default)(s),"remoteAudio",x.default.createRef()),(0,h.default)((0,c.default)(s),"notifyUser",function(){var e=(0,a.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.alert(t),r=s.setState.bind((0,c.default)(s)),e.abrupt("return",new Promise((function(e){return r({acceptCall:e})})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),console.log(s.props.match.params);var u=null===(t=s.state.user)||void 0===t||null===(r=t.friends)||void 0===r?void 0:r.find((function(e){return e.token===s.props.match.params.chatId}));return u&&null!==(n=s.state.user)&&void 0!==n&&n.tokens.private_token?s.state=_(_({},s.state),{},{openStatus:!1,chatUser:u,video:{enabled:!1,denied:!1},audio:{enabled:!1,denied:!1}}):s.props.history.replace("/chat"),s}return(0,s.default)(m,[{key:"componentDidMount",value:(t=(0,a.default)(i.default.mark((function e(){var t,r,n,a,o,s,c=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,u.default)((0,f.default)(m.prototype),"componentDidMount",this).call(this),this.state.auth&&null!==(t=this.state.user)&&void 0!==t&&null!==(r=t.tokens)&&void 0!==r&&r.private_token){e.next=3;break}return e.abrupt("return",this.performAuth());case 3:this.localVideo.current&&this.remoteVideo.current&&this.remoteAudio.current&&(s=new S.default(null===(n=this.state.user)||void 0===n||null===(a=n.tokens)||void 0===a?void 0:a.private_token,null===(o=this.state)||void 0===o?void 0:o.chatUser.token,this.localVideo.current,this.remoteVideo.current,this.remoteAudio.current,this.notifyUser),this.setState({rtc:s}),s.media.on("audioToggle",(function(e){console.log("video",e),c.setState({audio:{enabled:e,denied:!1}})})),s.media.on("videoToggle",(function(e){console.log("audio",e),c.setState({video:{enabled:e,denied:!1}})})),s.media.on("permissionDenied",(function(e){console.log(e+" denied"),("video"===e||"audio"===e)&&c.setState({video:{enabled:!1,denied:!0}})})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){(0,u.default)((0,f.default)(m.prototype),"componentWillUnmount",this).call(this),this.state.rtc.tearDown()}},{key:"render",value:function(){var e=this;return console.log(this.state.video,this.state.audio),(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)("div",{style:{zIndex:50,height:"100%",color:"#8DB5B4",backgroundColor:"#3E64FF"},children:[(0,R.jsxs)("div",{style:{padding:"1rem"},className:"d-flex justify-content-center align-items-center",children:[(0,R.jsx)(b.Link,{style:{textDecoration:"none"},to:"/chat/".concat(this.state.chatUser.token),children:(0,R.jsx)(T.default,{color:"error"})}),(0,R.jsx)(E.default,{style:{height:"1rem"}}),(0,R.jsx)("p",{className:"m-0",children:"End-to-end encrypted"})]}),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("video",{ref:this.localVideo,muted:!0,autoPlay:!0}),(0,R.jsx)("video",{ref:this.remoteVideo,autoPlay:!0,playsInline:!0}),(0,R.jsx)("audio",{ref:this.remoteAudio,autoPlay:!0}),(0,R.jsxs)("div",{style:{marginBottom:"40px"},children:[(0,R.jsx)(P,{onClick:function(){return e.state.rtc.makeCall()},children:"Call"}),(0,R.jsx)(P,{onClick:function(){return e.state.rtc.media.toggleCamera(!e.state.video.enabled)},children:"Video "+(this.state.video.enabled?"On":"Off")}),(0,R.jsx)(P,{onClick:function(){return e.state.rtc.media.toggleMic(!e.state.audio.enabled)},children:"Audio "+(this.state.audio.enabled?"On":"Off")}),(0,R.jsx)(P,{onClick:function(){return e.state.acceptCall(!0)},children:"Accept"}),(0,R.jsx)(P,{onClick:function(){return e.state.acceptCall(!1)},children:"Reject"}),(0,R.jsx)(P,{onClick:function(){return e.state.rtc.tearDown()},children:"Stop"})]}),(0,R.jsx)(p.Global,{styles:{".MuiDrawer-root > .MuiPaper-root":{height:"10%",overflow:"visible"}}})]})]})})}}]),m}(y.AuthComponent),A=(0,g.withRouter)(D);t.default=A}}]);
//# sourceMappingURL=chunk-706.90f8891bf619a206dec1.js.map